import com.sapher.youtubedl.YoutubeDL;
import com.sapher.youtubedl.YoutubeDLException;
import com.sapher.youtubedl.YoutubeDLRequest;
import com.sapher.youtubedl.YoutubeDLResponse;
import java.io.BufferedReader;
import java.io.File;
import java.io.IOException;
import java.io.StringReader;

public class SubtitleProcessor {

    /*
    Caption: Autogenerated by Youtube. Might not be precise.
    Subtitle: Might be more precise and more prioritized
     */

    public boolean idCapt = false;
    public boolean idSubs = false;
    public boolean enCapt = false;
    public boolean enSubs = false;
    protected String videoUrl = "";

    public SubtitleProcessor(String videoUrl) {
        this.videoUrl = videoUrl;
    }

//    public String getSubs() throws YoutubeDLException {
////        String videoURL = "https://www.youtube.com/watch?v=tTqu0arCV3s";
////        String url = "https://www.youtube.com/watch?v=BtN-goy9VOY";
////        String outDirectory = System.getProperty("java.io.tmpdir");
//
////        System.out.println(outDirectory);
//
//    }

    // TODO: Grab subtitle in SRT, SRT parser, Generator

    public void checkSubs() throws IOException, YoutubeDLException {

        YoutubeDLRequest yt = new YoutubeDLRequest(this.videoUrl);
        yt.setOption("list-subs");
        YoutubeDLResponse res = YoutubeDL.execute(yt);

        BufferedReader reader = new BufferedReader(new StringReader(res.getOut()));
        String line;
        while ((line = reader.readLine()) != null) {
            if (line.contains("Available automatic captions")) {
                line = reader.readLine();
                while (!(line.contains("Available") || (line.contains("has no")))) {
                    String check = line.substring(0, 2);
                    if (check.equals("id")) {
                        idCapt = true;
                    } else if (check.equals("en")) {
                        enCapt = true;
                    }
                    line = reader.readLine();
                }
            }
            if (line.contains("Available subtitles")) {
                line = reader.readLine();
                while (line != null) {
                    String check = line.substring(0, 2);
                    if (check.equals("id")) {
                        idSubs = true;
                    } else if (check.equals("en")) {
                        enSubs = true;
                    }
                    line = reader.readLine();
                }
            }
        }
    }

    /**
     * Get the subtitle/closed-captions from the video.
     *
     * lang     type    description
     * 0        0       English, closed-caption
     * 0        1       English, subtitle
     * 1        0       Indonesian, closed-caption
     * 1        1       Indonesian, subtitle
     *
     * @param lang choose the language of the captions
     * @param type choose the type of the captions
     * @return void
     */
    public void getSub(boolean lang, boolean type) {

    }
}
